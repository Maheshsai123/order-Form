<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Client Order Form</title>
<style>
  /* Same styles as before for neatness */
  body {
    font-family: "Poppins", sans-serif;
    background: #f9f9f9;
    margin: 0;
    padding: 20px;
  }
  .container {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    max-width: 1200px;
    margin: auto;
  }
  h2 {
    text-align: center;
    color: #222;
    margin-bottom: 20px;
  }
  .form-header {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-bottom: 20px;
  }
  .form-header input[type="text"],
  .form-header select,
  .form-header input[type="date"] {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 6px;
    flex: 1;
    font-size: 14px;
  }
  .actions-top {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-bottom: 15px;
  }
  button {
    background: #007bff;
    color: white;
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.3s;
    font-size: 14px;
  }
  button:hover {
    background: #0056b3;
    transform: scale(1.05);
  }
  .delete-btn {
    background: #dc3545;
    font-weight: bold;
    padding: 5px 10px;
  }
  .delete-btn:hover {
    background: #a71d2a;
  }
  table.styled-table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
  }
  table.styled-table th,
  table.styled-table td {
    border: 1px solid #ddd;
    padding: 10px 8px;
    text-align: center;
    vertical-align: middle;
    font-size: 14px;
    word-wrap: break-word;
  }
  table.styled-table th {
    background: #007bff;
    color: white;
  }
  td.size-cell {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding: 4px 8px;
    height: 100%;
    justify-content: center;
  }
  td.size-cell label {
    margin: 2px 0;
    font-size: 13px;
    cursor: pointer;
    user-select: none;
  }
  .styled-table input[type="text"],
  .styled-table input[type="number"],
  .styled-table select {
    padding: 6px 8px;
    font-size: 14px;
    width: 100%;
    box-sizing: border-box;
  }
  td.action-cell {
    text-align: center;
    padding: 8px;
  }
</style>
</head>
<body>
  <div class="container">
    <h2>Client Order Form</h2>

    <div class="actions-top">
      <button type="button" onclick="addRow()">+ Add Row</button>
      <button type="button" onclick="saveOrder()">üíæ Save Order</button>
      <button type="button" onclick="downloadExcel()">‚¨áÔ∏è Download Excel</button>
    </div>

    <form id="orderForm" method="POST" enctype="multipart/form-data">
      <div class="form-header">
        <input type="text" name="doc_no" id="doc_no" value="DOC0001" readonly />
        <select name="vendor" id="vendor" required>
          <option value="">-- Select Vendor --</option>
          <option value="Vendor A">Vendor A</option>
          <option value="Vendor B">Vendor B</option>
          <option value="Vendor C">Vendor C</option>
        </select>
        <input type="date" name="date" id="date" value="" readonly />
      </div>

      <table class="styled-table" id="orderTable">
        <thead>
          <tr>
            <th style="width: 40px;">S.No</th>
            <th style="width: 120px;">Item</th>
            <th style="width: 140px;">Design</th>
            <th style="width: 120px;">Color</th>
            <th style="width: 70px;">Size</th>
            <th style="width: 70px;">Qty</th>
            <th style="width: 160px;">Details</th>
            <th style="width: 130px;">Image</th>
            <th style="width: 60px;">Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </form>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
  document.getElementById("date").value = new Date().toISOString().split('T')[0];

  function addRow() {
    const table = document.getElementById("orderTable").getElementsByTagName('tbody')[0];
    const rowCount = table.rows.length;
    const row = table.insertRow(rowCount);

    row.innerHTML = `
      <td>${rowCount + 1}</td>
      <td>
        <select>
          <option value="">Select Item</option>
          <option value="Shirt">Shirt</option>
          <option value="Pant">Pant</option>
          <option value="T-Shirt">T-Shirt</option>
          <option value="Kurta">Kurta</option>
        </select>
      </td>
      <td>
        <select>
          <option value="">Select Design</option>
          <option value="Plain">Plain</option>
          <option value="Striped">Striped</option>
          <option value="Checked">Checked</option>
          <option value="Printed">Printed</option>
        </select>
      </td>
      <td><input type="text" placeholder="Color name or code" /></td>
      <td class="size-cell">
        <label><input type="checkbox" value="S" onclick="updateQty(this)"> S</label>
        <label><input type="checkbox" value="M" onclick="updateQty(this)"> M</label>
        <label><input type="checkbox" value="L" onclick="updateQty(this)"> L</label>
        <label><input type="checkbox" value="XL" onclick="updateQty(this)"> XL</label>
        <label><input type="checkbox" value="XXL" onclick="updateQty(this)"> XXL</label>
      </td>
      <td><input type="number" value="0" readonly /></td>
      <td><input type="text" placeholder="Additional details" /></td>
      <td><input type="file" accept="image/*" /></td>
      <td class="action-cell"><button type="button" class="delete-btn" onclick="deleteRow(this)">-</button></td>
    `;
  }

  function deleteRow(btn) {
    const row = btn.closest("tr");
    row.remove();
    updateSerialNumbers();
  }

  function updateSerialNumbers() {
    const rows = document.querySelectorAll("#orderTable tbody tr");
    rows.forEach((row, index) => {
      row.cells[0].innerText = index + 1;
    });
  }

  function updateQty(checkbox) {
    const row = checkbox.closest("tr");
    const qtyInput = row.querySelector("td:nth-child(6) input");
    const checkedCount = row.querySelectorAll("td.size-cell input[type='checkbox']:checked").length;
    qtyInput.value = checkedCount;
  }

  function saveOrder() {
    const rows = document.querySelectorAll("#orderTable tbody tr");
    if (rows.length === 0) {
      alert("Add at least one order row before saving.");
      return;
    }
    alert("‚úÖ Order saved! (Demo only)");
  }

  function downloadExcel() {
    const rows = document.querySelectorAll("#orderTable tbody tr");
    if (rows.length === 0) {
      alert("Add at least one order row before downloading.");
      return;
    }

    // Header info
    const docNo = document.getElementById("doc_no").value;
    const vendor = document.getElementById("vendor").value;
    const date = document.getElementById("date").value;

    // Start with form info
    const data = [
      ["Document Number:", docNo],
      ["Vendor:", vendor],
      ["Date:", date],
      [],
      ["S.No", "Item", "Design", "Color", "Size", "Quantity", "Details", "Image"]
    ];

    rows.forEach(row => {
      const rowData = [
        row.cells[0].innerText,
        row.cells[1].querySelector("select").value,
        row.cells[2].querySelector("select").value,
        row.cells[3].querySelector("input").value,
        Array.from(row.cells[4].querySelectorAll("input:checked")).map(c => c.value).join(","),
        row.cells[5].querySelector("input").value,
        row.cells[6].querySelector("input").value,
        row.cells[7].querySelector("input").files[0]?.name || ""
      ];
      data.push(rowData);
    });

    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Client Order");
    XLSX.writeFile(wb, "Client_Order.xlsx");
  }

  window.onload = () => {
    addRow();
  };
</script>
</body>
</html>
